<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction</h1>



<p><em>trending</em> aims to provides a coherent interface to several modelling tools. Whilst it is useful in an interactive context, it’s main focus is to provide an intuitive interface on which other packages can be developed (e.g. <a href="https://github.com/reconhub/trendbreaker"><em>trendbreaker</em></a>).</p>
<div id="main-features" class="section level1">
<h1>Main features</h1>
<ul>
<li><p><strong>Model specification:</strong> Interfaces to common models through intuitive functions; <code>lm_model()</code>, <code>glm_model()</code>, <code>glm_nb_model</code> and <code>brms_model</code>*.</p></li>
<li><p><strong>Model fitting and prediction:</strong> Once specified, models can be fit to data and generate confidence and prediction intervals for future data using <code>fit()</code> and <code>predict()</code>.</p></li>
</ul>
<p>*   Requires <a href="https://CRAN.R-project.org/package=brms">brms</a></p>
</div>
<div id="example-usage" class="section level1">
<h1>Example usage</h1>
<div id="an-individual-model" class="section level2">
<h2>An individual model</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(outbreaks)  <span class="co"># for data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(trending)   <span class="co"># for trend fitting</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)  <span class="co"># for data manipulation</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co"># load data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="kw">data</span>(covid19_england_nhscalls_<span class="dv">2020</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co"># define a model</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>model  &lt;-<span class="st"> </span><span class="kw">glm_nb_model</span>(count <span class="op">~</span><span class="st"> </span>day <span class="op">+</span><span class="st"> </span>weekday)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co"># select 6 weeks of data (from a period when the prevalence was decreasing)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>last_date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-05-28&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>first_date &lt;-<span class="st"> </span>last_date <span class="op">-</span><span class="st"> </span><span class="dv">8</span><span class="op">*</span><span class="dv">7</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>pathways_recent &lt;-</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a><span class="st">  </span>covid19_england_nhscalls_<span class="dv">2020</span> <span class="op">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(date <span class="op">&gt;=</span><span class="st"> </span>first_date, date <span class="op">&lt;=</span><span class="st"> </span>last_date) <span class="op">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(date, day, weekday) <span class="op">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">sum</span>(count), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="co"># split data for fitting and prediction</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>dat &lt;-</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="st">  </span>pathways_recent <span class="op">%&gt;%</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(date <span class="op">&lt;=</span><span class="st"> </span>first_date <span class="op">+</span><span class="st"> </span><span class="dv">6</span><span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_split</span>()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>fitting_data &lt;-<span class="st"> </span>dat[[<span class="dv">2</span>]]</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>pred_data &lt;-<span class="st"> </span><span class="kw">select</span>(dat[[<span class="dv">1</span>]], date, day, weekday)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>fitted_model &lt;-<span class="st"> </span><span class="kw">fit</span>(model, fitting_data)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="co"># default</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>fitted_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(pred_data) <span class="op">%&gt;%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a><span class="st">  </span><span class="kw">glimpse</span>()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a><span class="co">#&gt; Rows: 14</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a><span class="co">#&gt; Columns: 8</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a><span class="co">#&gt; $ date     &lt;date&gt; 2020-05-15, 2020-05-16, 2020-05-17, 2020-05-18, 2020-05-19, …</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a><span class="co">#&gt; $ day      &lt;int&gt; 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a><span class="co">#&gt; $ weekday  &lt;fct&gt; rest_of_week, weekend, weekend, monday, rest_of_week, rest_of…</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a><span class="co">#&gt; $ estimate &lt;dbl&gt; 12682.379, 10624.988, 10261.987, 13839.821, 11036.028, 10658.…</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a><span class="co">#&gt; $ lower_ci &lt;dbl&gt; 11389.734, 9298.983, 8955.560, 11749.030, 9782.389, 9416.365,…</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a><span class="co">#&gt; $ upper_ci &lt;dbl&gt; 14121.729, 12140.078, 11758.995, 16302.677, 12450.323, 12065.…</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a><span class="co">#&gt; $ lower_pi &lt;dbl&gt; 8750, 7309, 7152, 9534, 7663, 7169, 7202, 6932, 5656, 5563, 7…</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a><span class="co">#&gt; $ upper_pi &lt;dbl&gt; 17091, 14588, 14101, 19191, 15076, 14380, 14191, 13642, 11453…</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a><span class="co"># without prediction intervals</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>fitted_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(pred_data, <span class="dt">add_pi =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a><span class="st">  </span><span class="kw">glimpse</span>()</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a><span class="co">#&gt; Rows: 14</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a><span class="co">#&gt; Columns: 6</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a><span class="co">#&gt; $ date     &lt;date&gt; 2020-05-15, 2020-05-16, 2020-05-17, 2020-05-18, 2020-05-19, …</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a><span class="co">#&gt; $ day      &lt;int&gt; 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a><span class="co">#&gt; $ weekday  &lt;fct&gt; rest_of_week, weekend, weekend, monday, rest_of_week, rest_of…</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a><span class="co">#&gt; $ estimate &lt;dbl&gt; 12682.379, 10624.988, 10261.987, 13839.821, 11036.028, 10658.…</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a><span class="co">#&gt; $ lower_ci &lt;dbl&gt; 11389.734, 9298.983, 8955.560, 11749.030, 9782.389, 9416.365,…</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a><span class="co">#&gt; $ upper_ci &lt;dbl&gt; 14121.729, 12140.078, 11758.995, 16302.677, 12450.323, 12065.…</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a><span class="co"># without uncertainty</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>fitted_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(pred_data, <span class="dt">uncertainty =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a><span class="st">  </span><span class="kw">glimpse</span>()</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a><span class="co">#&gt; Rows: 14</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a><span class="co">#&gt; Columns: 8</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a><span class="co">#&gt; $ date     &lt;date&gt; 2020-05-15, 2020-05-16, 2020-05-17, 2020-05-18, 2020-05-19, …</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a><span class="co">#&gt; $ day      &lt;int&gt; 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a><span class="co">#&gt; $ weekday  &lt;fct&gt; rest_of_week, weekend, weekend, monday, rest_of_week, rest_of…</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a><span class="co">#&gt; $ estimate &lt;dbl&gt; 12682.379, 10624.988, 10261.987, 13839.821, 11036.028, 10658.…</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a><span class="co">#&gt; $ lower_ci &lt;dbl&gt; 11389.734, 9298.983, 8955.560, 11749.030, 9782.389, 9416.365,…</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a><span class="co">#&gt; $ upper_ci &lt;dbl&gt; 14121.729, 12140.078, 11758.995, 16302.677, 12450.323, 12065.…</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a><span class="co">#&gt; $ lower_pi &lt;dbl&gt; 9070, 7401, 7198, 9615, 7675, 7489, 7136, 6847, 5702, 5393, 7…</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a><span class="co">#&gt; $ upper_pi &lt;dbl&gt; 17184, 14557, 14030, 18996, 15255, 14584, 14255, 13568, 11433…</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a><span class="co"># non-bootstraped (parametric) prediction intervals</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>fitted_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(pred_data, <span class="dt">simulate_pi =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a><span class="st">  </span><span class="kw">glimpse</span>()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a><span class="co">#&gt; Rows: 14</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a><span class="co">#&gt; Columns: 8</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true"></a><span class="co">#&gt; $ date     &lt;date&gt; 2020-05-15, 2020-05-16, 2020-05-17, 2020-05-18, 2020-05-19, …</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true"></a><span class="co">#&gt; $ day      &lt;int&gt; 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true"></a><span class="co">#&gt; $ weekday  &lt;fct&gt; rest_of_week, weekend, weekend, monday, rest_of_week, rest_of…</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true"></a><span class="co">#&gt; $ estimate &lt;dbl&gt; 12682.379, 10624.988, 10261.987, 13839.821, 11036.028, 10658.…</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true"></a><span class="co">#&gt; $ lower_ci &lt;dbl&gt; 11389.734, 9298.983, 8955.560, 11749.030, 9782.389, 9416.365,…</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true"></a><span class="co">#&gt; $ upper_ci &lt;dbl&gt; 14121.729, 12140.078, 11758.995, 16302.677, 12450.323, 12065.…</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true"></a><span class="co">#&gt; $ lower_pi &lt;dbl&gt; 8107, 6618, 6373, 8363, 6962, 6701, 6450, 6208, 5079, 4889, 6…</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true"></a><span class="co">#&gt; $ upper_pi &lt;dbl&gt; 18870, 16223, 15714, 21784, 16638, 16124, 15626, 15145, 12992…</span></span></code></pre></div>
</div>
<div id="multiple-models" class="section level2">
<h2>Multiple models</h2>
<p>When working with a list of models Trending captures both errors and warnings so the user can choose how to proceed. In this situation the fitted output will be of class <code>trending_model_fit_list</code> which is a list with named lists for each model containing components result, warnings and errors. If an error occurs, then the error object is captured and the result has a NULL value. If the model does not error then result is the corresponding model output and the error entry will be NULL. Similarly, the warning component will be a vector of all warnings that occurred.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>models  &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>  <span class="dt">simple =</span> <span class="kw">lm_model</span>(count <span class="op">~</span><span class="st"> </span>day),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  <span class="dt">glm_poisson =</span> <span class="kw">glm_model</span>(count <span class="op">~</span><span class="st"> </span>day, <span class="dt">family =</span> <span class="st">&quot;poisson&quot;</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  <span class="dt">glm_negbin =</span> <span class="kw">glm_nb_model</span>(count <span class="op">~</span><span class="st"> </span>day <span class="op">+</span><span class="st"> </span>weekday),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>  <span class="dt">will_error =</span> <span class="kw">glm_nb_model</span>(count <span class="op">~</span><span class="st"> </span>day <span class="op">+</span><span class="st"> </span>nonexistant)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>res &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(fitting_data)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>res</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="co">#&gt;   model_name  data                 fitted_model  fitting_warnings fitting_errors</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;list&gt;               &lt;named list&gt;  &lt;named list&gt;     &lt;named list&gt;  </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="co">#&gt; 1 simple      &lt;tibble[,5] [43 × 5… &lt;trndng__ [2… &lt;NULL&gt;           &lt;NULL&gt;        </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="co">#&gt; 2 glm_poisson &lt;tibble[,5] [43 × 5… &lt;trndng__ [2… &lt;NULL&gt;           &lt;NULL&gt;        </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="co">#&gt; 3 glm_negbin  &lt;tibble[,5] [43 × 5… &lt;trndng__ [2… &lt;NULL&gt;           &lt;NULL&gt;        </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="co">#&gt; 4 will_error  &lt;tibble[,5] [43 × 5… &lt;NULL&gt;        &lt;NULL&gt;           &lt;chr [1]&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a><span class="co">#&gt; Rows: 4</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a><span class="co">#&gt; Columns: 5</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a><span class="co">#&gt; $ model_name       &lt;chr&gt; &quot;simple&quot;, &quot;glm_poisson&quot;, &quot;glm_negbin&quot;, &quot;will_error&quot;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a><span class="co">#&gt; $ data             &lt;list&gt; [&lt;tbl_df[43 x 5]&gt;], [&lt;tbl_df[43 x 5]&gt;], [&lt;tbl_df[43 x…</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a><span class="co">#&gt; $ fitted_model     &lt;named list&gt; [[69201.584, -1092.913, 19109.1089, 11650.0217, 1789…</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="co">#&gt; $ fitting_warnings &lt;named list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a><span class="co">#&gt; $ fitting_errors   &lt;named list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &quot;object &#39;nonexistant&#39; …</span></span></code></pre></div>
<p><code>trending_model_fit_list</code> objects can then be used with <code>predict()</code> which similarly captures warnings and errors and returns the model predictions in a column called <strong>output</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>res &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">fit</span>(fitting_data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">predict</span>(pred_data)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>res</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 4 x 8</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="co">#&gt;   model_name  data        fitted_model fitting_warnings fitting_errors output   </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;list&gt;      &lt;named list&gt; &lt;named list&gt;     &lt;named list&gt;   &lt;named l&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="co">#&gt; 1 simple      &lt;tibble[,5… &lt;trndng__ [… &lt;NULL&gt;           &lt;NULL&gt;         &lt;df[,8] …</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="co">#&gt; 2 glm_poisson &lt;tibble[,5… &lt;trndng__ [… &lt;NULL&gt;           &lt;NULL&gt;         &lt;df[,8] …</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="co">#&gt; 3 glm_negbin  &lt;tibble[,5… &lt;trndng__ [… &lt;NULL&gt;           &lt;NULL&gt;         &lt;df[,8] …</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="co">#&gt; 4 will_error  &lt;tibble[,5… &lt;NULL&gt;       &lt;NULL&gt;           &lt;chr [1]&gt;      &lt;NULL&gt;   </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="co">#&gt; # … with 2 more variables: prediction_warnings &lt;named list&gt;,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="co">#&gt; #   prediction_errors &lt;named list&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="co">#&gt; Rows: 4</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="co">#&gt; Columns: 8</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="co">#&gt; $ model_name          &lt;chr&gt; &quot;simple&quot;, &quot;glm_poisson&quot;, &quot;glm_negbin&quot;, &quot;will_error&quot;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="co">#&gt; $ data                &lt;list&gt; [&lt;tbl_df[43 x 5]&gt;], [&lt;tbl_df[43 x 5]&gt;], [&lt;tbl_df[4…</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="co">#&gt; $ fitted_model        &lt;named list&gt; [[69201.584, -1092.913, 19109.1089, 11650.0217, 1…</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="co">#&gt; $ fitting_warnings    &lt;named list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="co">#&gt; $ fitting_errors      &lt;named list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &quot;object &#39;nonexistan…</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="co">#&gt; $ output              &lt;named list&gt; [&lt;data.frame[14 x 8]&gt;], [&lt;data.frame[14 x 8…</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="co">#&gt; $ prediction_warnings &lt;named list&gt; &lt;NULL&gt;, &quot;The response is not continuous, so…</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="co">#&gt; $ prediction_errors   &lt;named list&gt; &lt;NULL&gt;, &lt;NULL&gt;, &lt;NULL&gt;, &quot;no applicable meth…</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
